# QA-019C — CI E2E Wake-Word Test with PipeWire Loopback (Linux Runner)

**Goal:** Run the wake-word E2E harness in CI with real audio by enabling PipeWire loopback on GitHub's Ubuntu runner, playing the bundled sample, and asserting `kws:wake_test_pass` within the armed window.

## Why
Automates deterministic KWS validation. Replaces manual checks with a required CI gate.

## Deliverables
- GitHub Actions job `qa-kws-e2e-loopback`:
  - Starts PipeWire & WirePlumber in CI
  - Sets up loopback (null-sink + loopback)
  - Builds the app (debug) and runs E2E harness with `EMB_LOOPBACK=1`
  - Fails CI on non-zero exit
- Robust teardown and readable logs
- Docs update in `docs/QA-019-KWS-Smoke.md` (CI section)

## Acceptance Criteria
- ✅ Job passes on `main` and relevant PRs
- ✅ Exit code semantics: 0=pass, 1=timeout, 2=error
- ✅ Total runtime ≤ 4 min with caching
- ✅ Simulation fallback is possible but marks build ❌ (not skipped)

## Implementation Notes
- Use `dbus-run-session` to launch `pipewire` + `wireplumber` on the runner.
- Ensure `pipewire-pulse` is installed so `pactl` talks to PipeWire.
- Use `xvfb-run` to satisfy WebView/X11 needs when launching the harness.
- Consider caching models keyed by checksum (optional; license-permitting).

## Commands (local parity)
```bash
make qa-kws-e2e-loopback
```
